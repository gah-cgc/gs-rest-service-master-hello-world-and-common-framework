#!/bin/sh

echo "############################################"
echo "## Begin ETP Custom Pre-Build Step: assemble"
echo "##"

# Setup environment variables
DEFAULT_DIR=$(pwd)
S2I_SOURCE_DIR=/tmp/src
REAL_SCRIPT_DIR=/usr/local/s2i
MVN_CMDLINE="mvn -B -U versions:use-latest-versions -DallowSnapshots=false -DfailIfNotReplaced=true -Dincludes=com.capgroup.equitytrading"

# Print environment variables
echo "CURR_DIR=$DEFAULT_DIR"
echo "S2I_SOURCE_DIR=$S2I_SOURCE_DIR"
echo "REAL_SCRIPT_DIR=$REAL_SCRIPT_DIR"
#source "${REAL_SCRIPT_DIR}/s2i-setup"

# Run pre-build step with Maven
pwd
cd ${S2I_SOURCE_DIR}
pwd
mvn -v
echo "Running command: $MVN_CMDLINE"
${MVN_CMDLINE}
diff pom.xml pom.xml.versionsBackup
cd ${DEFAULT_DIR}

# Proceed to the platform provided build process
${REAL_SCRIPT_DIR}/assemble

echo "##"
echo "## End ETP Custom Pre-Build Step: assemble"
echo "############################################"
